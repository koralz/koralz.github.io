<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Koralz Archive</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- film grain overlay -->
  <div class="grain"></div>

  <!-- archive header -->
  <header>
    <h1>Koralz</h1>
    <p>personal archive</p>
  </header>

  <!-- folder view -->
  <main class="folders">

    <div class="folder" data-folder="people">
      <img src="icons/folder.png" alt="">
      <span>People</span>
    </div>

    <div class="folder" data-folder="nature">
      <img src="icons/folder.png" alt="">
      <span>Nature</span>
    </div>

    <div class="folder" data-folder="cities">
      <img src="icons/folder.png" alt="">
      <span>Cities</span>
    </div>

  </main>

  <!-- fullscreen photo pile viewer -->
  <div class="viewer" id="viewer"></div>

  <!-- pile script -->
  <script>
    const folders = document.querySelectorAll('.folder');
    const viewer = document.getElementById('viewer');

    const archive = {
      people: [
        'images/people1.jpg',
        'images/people2.jpg'
      ],
      nature: [
        'images/nature1.jpg',
        'images/nature2.jpg'
      ],
      cities: [
        'images/DSCF0009.jpeg',
        'images/DSCF0071.jpeg',
        'images/DSCF0087.jpeg'
      ]
    };

    let currentPile = [];
    let topIndex = 0;

    // small random rotation and offset
    function randomTransform() {
      const rotate = Math.random() * 10 - 5; // -5° to 5°
      const x = Math.random() * 30 - 15;     // -15px to 15px
      const y = Math.random() * 30 - 15;
      return `translate(${x}px, ${y}px) rotate(${rotate}deg)`;
    }

    function updatePile() {
      currentPile.forEach((img, i) => {
        img.style.zIndex = i;
        if (i === topIndex) {
          img.style.opacity = '1';
          img.style.transform = 'translate(0,0) rotate(0deg) scale(1.05)'; // top image lift
        } else {
          img.style.opacity = '0.85';
          img.style.transform = img.dataset.origTransform; // preserve rotation/offset
        }
      });
    }

    // Open folder
    folders.forEach(folder => {
      folder.addEventListener('click', () => {
        const key = folder.dataset.folder;
        viewer.innerHTML = ''; // clear previous pile

        currentPile = archive[key].map(src => {
          const img = document.createElement('img');
          img.src = src;
          img.style.position = 'absolute';
          img.style.top = '50%';
          img.style.left = '50%';
          img.style.transformOrigin = 'center center';
          img.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
          img.style.maxWidth = '90vw';
          img.style.maxHeight = '90vh';
          img.style.cursor = 'grab';
          img.style.opacity = '0.95';

          const tf = randomTransform();
          img.style.transform = tf;
          img.dataset.origTransform = tf; // store original rotation/offset

          viewer.appendChild(img);
          return img;
        });

        topIndex = 0;
        updatePile();
        viewer.classList.add('active');
      });
    });

    // Scroll wheel flips through images
    viewer.addEventListener('wheel', e => {
      if (!currentPile.length) return;

      if (e.deltaY > 0) {
        topIndex = (topIndex + 1) % currentPile.length;
      } else {
        topIndex = (topIndex - 1 + currentPile.length) % currentPile.length;
      }
      updatePile();
      e.preventDefault();
    });

    // Exit viewer
    function closeViewer() {
      viewer.classList.remove('active');
      viewer.innerHTML = '';
      currentPile = [];
    }

    viewer.addEventListener('click', closeViewer);
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeViewer();
    });
  </script>

</body>
</html>
